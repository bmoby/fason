$(document).ready(function(){var g=new Pusher('095ff3028ab7bceb6073',{encrypted:true});$(function(){$(".limit").each(function(a){len=$(this).text().length;if(len>40){$(this).text($(this).text().substr(0,40)+'...')}})});$(function(){$(".limit-large").each(function(a){len=$(this).text().length;if(len>70){$(this).text($(this).text().substr(0,70)+'...')}})});$(".close-conv-2").on('click',function(){var b=this.getAttribute("data-conv-id-data2");$.ajax({url:'/clearNotif',method:'POST',contentType:'application/json',data:JSON.stringify({"conversationId":b}),success:function(a){if(a){window.location.replace("http://fason.co/inbox")}}})})$('.conversation-row').on('click',function(){var b=this.getAttribute("data-conv-id");$.ajax({url:'/clearNotif',method:'POST',contentType:'application/json',data:JSON.stringify({"conversationId":b}),success:function(a){console.log('messages are now marked as read')}})})$('.message-text-body').keypress(function(a){var b=a.which;if(b==13){$('.send-message-btn-proper').click();return false}if(b==27){$(".close-conv-2").click();return false}});$('.send-message-btn-proper').on('click',function(){var c=$('.message-text-body').val();var d=this.getAttribute("data-conv-id-data");var e=[];var h=$('.participant').first().text();var i=$('.participant').last().text();var e=[h,i];if(c!=""){$.ajax({url:'/getMyInfo',method:'GET',success:function(a){if(a.found){$('.messages-container-div').append('
'+c+'

'+a.time+'

')$(".messages-container-div").animate({scrollTop:$(".messages-container-div")[0].scrollHeight},-500)}if(a.err){console.log(a.err)}}})function j(b){$.ajax({url:'/checkIfConvParticipantsActiv',method:'POST',contentType:'application/json',data:JSON.stringify({"participants":e,"conversationId":d}),success:function(a){b()}})};j(function(){$.ajax({url:'/saveMsg',method:'POST',contentType:'application/json',data:JSON.stringify({"message":c,"conversationId":d})})})$.ajax({url:'/msgNotif',method:'POST',contentType:'application/json',data:JSON.stringify({"msg":c,"participants":e,"convId":d}),success:function(a){$('.message-text-body').val("")}})}else{alert("Vous ne pouvez pas envoyer un message vierge")}})function k(c){$.ajax({url:'/currentUser',method:'GET',success:function(a){var b=a.userId;c(b)}})};k(function(b){var c=g.subscribe(b);c.bind('new-message',function(a){if(a.msg){$('.messages-container-div').append('
'+a.msg+'

'+a.msgTime+'

')$(".messages-container-div").animate({scrollTop:$(".messages-container-div")[0].scrollHeight},-500)}})});var f=$('div');$('.delete-conversation-icon').on('click',function(b){b.stopPropagation();b.preventDefault();f=this.closest('.conversation-row');var c=this.closest('.conversation-row').getAttribute("data-conv-id");$.confirm({title:'Supprimer',content:'Etes vous sure de vouloir supprimer cette conversation?',buttons:{oui:function(){$.ajax({url:'/deleteConversation',method:'POST',contentType:'application/json',data:JSON.stringify({"convId":c}),success:function(a){if(a.ok){$(f).remove();$.ajax({url:'/clearNotif',method:'POST',contentType:'application/json',data:JSON.stringify({"conversationId":c})})}else{alert("Une erreur s'est produite, veuillez r?essayer plus tard.")}}})},non:function(){}}})})})
